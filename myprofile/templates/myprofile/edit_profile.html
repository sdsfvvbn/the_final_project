{% load static %}
{% load i18n %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% trans "Edit Profile" %}</title>
    <link rel="stylesheet" type="text/css" href="{% static 'profile/styles.css' %}" />
    <!-- Font Awesome CDN for + icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>

<body>
    <!-- =======================
        編輯個人資料主區塊
    ======================= -->
    <header>
        <div class="top-nav">
            <div class="logo">
                <a href="{% url 'homepage' %}">
                    <img src="{% static 'homepage/assets/Logo.png' %}" alt="{% trans 'TalentSwap Logo' %}"
                        style="width: 100px; height: auto;">
                </a>
            </div>
            <div class="user-info">
                <span>{% trans "Hi, " %}{{ profile.user.username }}!</span>
                <div class="user-avatar">
                    <img src="{{ profile.avatar.url }}" alt="{% trans 'User Avatar' %}">
                </div>

                <!-- =======================
                    技能區塊：能教技能
                ======================= -->
                <div class="skills">
                    <h3>{% trans "Can Teach" %}</h3>
                    {% for skill in profile.can_teach.all %}
                        <span class="tag">{{ skill.name }}</span>
                    {% empty %}
                        <span>{% trans "No teaching skills." %}</span>
                    {% endfor %}
                    <a href="{% url 'edit_profile' %}" class="add-tag-link" title="{% trans 'Edit skills' %}">
                        <i class="fa fa-plus add-icon"></i>
                    </a>
                </div>

                <!-- =======================
                    個性標籤區塊
                ======================= -->
                <div class="personality">
                    <h3>{% trans "Personality" %}</h3>
                    {% for trait in profile.personality.all %}
                        <span class="tag">{{ trait.name }}</span>
                    {% empty %}
                        <span>{% trans "No traits specified." %}</span>
                    {% endfor %}
                    <a href="{% url 'edit_profile' %}" class="add-tag-link" title="{% trans 'Edit personality' %}">
                        <i class="fa fa-plus add-icon"></i>
                    </a>
                </div>

                <!-- =======================
                    上課型態（多選小方塊）
                ======================= -->
                <label>{% trans "Preferred Class Type" %}：</label>
                <div class="checkbox-group">
                {% for ct in class_types %}
                    <label class="checkbox-label">
                        <input type="checkbox" name="class_type" value="{{ ct.id }}"
                            {% if ct in profile.class_type.all %}checked{% endif %}>
                        {{ ct.name }}
                    </label>
                {% endfor %}
                </div><br>

                <!-- =======================
                    可上課時間
                ======================= -->
                <label for="available_time">{% trans "Available Time" %}：</label>
                <textarea id="available_time" name="available_time" rows="3">{{ profile.available_time }}</textarea><br>

                <!-- =======================
                    自我介紹
                ======================= -->
                <label for="self_intro">{% trans "Self Introduction" %}：</label>
                <textarea id="self_intro" name="self_intro" rows="5">{{ profile.self_intro }}</textarea><br>

                <button type="submit" class="btn">{% trans "Save" %}</button>
            </form>
        </div>
    </section>
</main>

    <main>
        <section class="profile">
            <h1>
                {% trans "Edit Profile" %}
                <!-- 返回個人頁面的連結 -->
                <a href="{% url 'profile_view' %}" class="btn" style="margin-left:10px;">{% trans "Back" %}</a>
            </h1>
            <div class="profile-card">
                <!-- 編輯表單開始 -->
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <!-- 頭像上傳 -->
                    <label for="avatar">{% trans "Avatar" %}：</label>
                    <input type="file" id="avatar" name="avatar"><br>
                    {% if profile.avatar %}
                    <img src="{{ profile.avatar.url }}" alt="{% trans 'Current Avatar' %}" width="80">
                    {% endif %}

                    <!-- Instagram -->
                    <label for="instagram">{% trans "Instagram" %}：</label>
                    <input type="text" id="instagram" name="instagram" value="{{ profile.instagram }}"><br>

                    <!-- 城市 -->
                    <label for="city">{% trans "City" %}：</label>
                    <input type="text" id="city" name="city" value="{{ profile.city }}"><br>

                    <!-- 想學技能 -->
                    <h3>{% trans "Want to Learn" %}</h3>
                    {% for category in skill_categories %}
                    <div class="skill-category-block">
                        <h4>{{ category.name }}</h4>
                        <div class="skill-checkbox-group">
                            {% for skill in category.skills.all %}
                            <label class="skill-checkbox">
                                <input type="checkbox" name="want_to_learn" value="{{ skill.id }}" {% if skill in profile.want_to_learn.all %}checked{% endif %}>
                                {{ skill.name }}
                            </label>
                            {% empty %}
                            <p>{% trans "No skills in this category." %}</p>
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}

                    <!-- 可以教技能 -->
                    <h3>{% trans "Can Teach" %}</h3>
                    {% for category in skill_categories %}
                    <div class="skill-category-block">
                        <h4>{{ category.name }}</h4>
                        <div class="skill-checkbox-group">
                            {% for skill in category.skills.all %}
                            <label class="skill-checkbox">
                                <input type="checkbox" name="can_teach" value="{{ skill.id }}" 
                                    {% if skill in profile.can_teach.all %}checked{% endif %}>
                                {{ skill.name }}
                            </label>
                            {% empty %}
                            <p>{% trans "No skills in this category." %}</p>
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}



                    <!-- 個性標籤 -->
                    <div class="personality">
                        <h3>{% trans "Personality" %}</h3>
                        <div class="checkbox-group">
                            {% for tag in tags %}
                            <label>
                                <input type="checkbox" name="personality" value="{{ tag.id }}" 
                                    {% if tag in profile.personality.all %}checked{% endif %}>
                                {{ tag.name }}
                            </label>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- 上課型態（多選小方塊） -->
                    <label>{% trans "Preferred Class Type" %}：</label>
                    <div class="checkbox-group">
                        {% for ct in class_types %}
                        <label class="checkbox-label">
                            <input type="checkbox" name="class_type" value="{{ ct.id }}" 
                                {% if ct in profile.class_type.all %}checked{% endif %}>
                            {{ ct.name }}
                        </label>
                        {% endfor %}
                    </div><br>

                    <!-- 可上課時間 -->
                    <label for="available_time">{% trans "Available Time" %}：</label>
                    <textarea id="available_time" name="available_time"
                        rows="3">{{ profile.available_time }}</textarea><br>

                    <!-- 自我介紹 -->
                    <label for="self_intro">{% trans "Self Introduction" %}：</label>
                    <textarea id="self_intro" name="self_intro" rows="5">{{ profile.self_intro }}</textarea><br>

                    <button type="submit" class="btn">{% trans "Save" %}</button>
                </form>
                <!-- 編輯表單結束 -->
            </div>
        </section>
    </main>

    <!-- 編輯彈窗（點 + 號會出現）
    <div class="modal-bg" id="editModal">
        <div class="modal-content">
            <h3 id="modalTitle"></h3>
            <input type="text" id="editInput" />
            <div>
                <button type="button" onclick="saveEdit()">OK</button>
                <button type="button" onclick="closeEditModal()">Cancel</button>
            </div>
        </div>
    </div> -->


<script>
    // 彈窗資料
    let currentEditType = '';
    let currentEditId = '';
    let currentLabelElem = null;

    // 開啟編輯彈窗
    function openEditModal(type, id, name) {
        currentEditType = type;
        currentEditId = id;
        // 找到對應的 label 元素
        currentLabelElem = document.querySelector(
            '.editable-label[data-type="' + type + '"][data-id="' + id + '"]'
        );
        document.getElementById('modalTitle').innerText = (type === 'skill' ? '編輯技能名稱' : '編輯個性名稱');
        document.getElementById('editInput').value = name;
        document.getElementById('editModal').style.display = 'flex';
    }
    // 關閉彈窗
    function closeEditModal() {
        document.getElementById('editModal').style.display = 'none';
    }
    // 儲存編輯（僅前端示範，實際應送 AJAX 到後端）
    function saveEdit() {
        const newName = document.getElementById('editInput').value;
        if (currentLabelElem && newName.trim() !== '') {
            currentLabelElem.innerText = newName;
        }
        // 關閉彈窗
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
        }
        // 儲存編輯（僅前端示範，實際應送 AJAX 到後端）
        function saveEdit() {
            const newName = document.getElementById('editInput').value;
            if (currentLabelElem && newName.trim() !== '') {
                currentLabelElem.innerText = newName;
            }
            closeEditModal();
            // 實際專案應該用 AJAX 將新名稱送到後端並更新資料庫
        }

</html>
